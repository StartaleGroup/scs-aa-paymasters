// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.29;

import {Script, console} from "forge-std/Script.sol";
import "../src/deployer/Deployer.sol";

contract DeploySponsorshipPaymasterCreate3 is Script {
    Deployer deployerInstance;
    address entryPoint;
    mapping(uint256 => uint256) public DEPLOYMENT_CHAIN_GAS_PRICES;

    function setUp() public {
        deployerInstance = Deployer(vm.envAddress("DEPLOYER_CONTRACT_ADDRESS")); // Set Deployer contract
        // EntryPoint v0.7 address
        entryPoint = vm.parseAddress("0x0000000071727De22E5E9d8BAf0edAc6f37da032");
        DEPLOYMENT_CHAIN_GAS_PRICES[1946] = 0.002 gwei;
    }

    function run() public {
        uint256 deployerPrivateKey = vm.envUint("DEPLOYER_CONTRACT_DEPLOYER_PRIVATE_KEY");

        string memory contractName = "SponsorshipPaymaster";
        string memory saltString = "SPONSORSHIP_PAYMASTER_V_1_0_0_SALT_200525_9S16Gek"; // todo: get it from env
        // for above salt the address would be 0x00000016a9b189992551854a5efc14e5eef7c46b

        // Review
        bytes memory deployedBytecode =
            hex"60a060405234610128576126b7803803809161001a82610140565b60a03960e08160a001911261012857610031610189565b61003b60c061019f565b60e051926001600160401b038411610128578060bf850112156101285760a0840151906001600160401b03821161012c578160051b94604051926100826020880185610166565b835260c060208401968201019182116101285760c001945b8186106101105750506100c793506100b361010061019f565b6101205191610140519361016051956101b3565b6040516121be90816104f9823960805181818161073d015281816107e6015281816108940152818161091c015281816109f601528181610e91015281816117f30152611d360152f35b6020809161011d8861019f565b81520195019461009a565b5f80fd5b634e487b7160e01b5f52604160045260245ffd5b60a0601f91909101601f19168101906001600160401b0382119082101761012c57604052565b601f909101601f19168101906001600160401b0382119082101761012c57604052565b60a051906001600160a01b038216820361012857565b51906001600160a01b038216820361012857565b6101c6916001600160a01b031690610379565b80518015610342575f5b818110610266575050506102619261023c8593610237846102157f33ddf610723ec48e858790576fb3294cc312fcbd937c1475d53e3673145488eb9961024197610448565b600180546001600160a01b0319166001600160a01b0392909216919091179055565b600255565b600555565b61024a81600655565b604051918291829190602060408401935f81520152565b0390a1565b61028f6102836102768386610351565b516001600160a01b031690565b6001600160a01b031690565b15610333576102aa6102a46102768386610351565b3b151590565b61032457806102ea6102dd6102c461027660019588610351565b6001600160a01b03165f90815260208190526040902090565b805460ff19166001179055565b6102fa6102836102768387610351565b7f47d1c22a25bb3a5d4e481b9b1e6944c2eade3181a0a20b495ed61d35b5323f245f80a2016101d0565b6319e573cb60e11b5f5260045ffd5b63c943590960e01b5f5260045ffd5b63b5fa16ed60e01b5f5260045ffd5b80518210156103655760209160051b010190565b634e487b7160e01b5f52603260045260245ffd5b8060601b1561043b576001600160a01b0316638b78c6d8198190555f7f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e08180a36040516301ffc9a760e01b815263122a0e9b60e31b60048201526020816024816001600160a01b0386165afa8015610430576103fc915f91610401575b506104ac565b608052565b610423915060203d602011610429575b61041b8183610166565b810190610494565b5f6103f6565b503d610411565b6040513d5f823e3d90fd5b637448fbae5f526004601cfd5b6001600160a01b03811661046557633fd0943d60e11b5f5260045ffd5b3b1561047a57631f47525f60e21b5f5260045ffd5b620249f01061048557565b63313db2a560e11b5f5260045ffd5b90816020910312610128575180151581036101285790565b156104b357565b60405162461bcd60e51b815260206004820152601e60248201527f49456e747279506f696e7420696e74657266616365206d69736d6174636800006044820152606490fdfe6080604052600436101561001a575b3615610018575f80fd5b005b5f5f3560e01c80630396cb60146117c35780630e316ab7146117245780631b9a91a414611629578063205c2878146115e6578063226112801461158e57806325692962146115435780633499117e1461152557806341b3d1851461150757806344004cc1146113fe57806352b7512c1461137957806354d1f13d14611333578063715018a6146112f7578063736c0d5b14610d7157806373acf542146112735780637c627b2114610ff05780637deb926014610dad5780637df73e2714610d715780638c661b5d14610d285780638da5cb5b14610cfd5780638fcc9cfb14610c7a57806394d4ad6014610ba45780639d31b69d14610207578063a42dce8014610b00578063aa67c9191461095e578063ab94cad714610940578063b0d691fe146108fc578063bb9fe6bf14610870578063c23a5cea146107b9578063c399ec88146106f0578063c415b95c146106c9578063d0e30db014610695578063d2c13da51461060c578063da95ebf7146104a1578063def0425714610409578063eb12d61e1461030a578063f04e283e14610285578063f2fde38b1461023f578063f8b2cb4f146102075763fee81cf4146101d2575061000e565b34610204576020366003190112610204576101eb61187b565b9063389a75e1600c5252602080600c2054604051908152f35b80fd5b50346102045760203660031901126102045760406020916001600160a01b0361022e61187b565b168152600383522054604051908152f35b5060203660031901126102045760049061025761187b565b50610260611c9c565b7feb0149e8000000000000000000000000000000000000000000000000000000008152fd5b5060203660031901126102045761029a61187b565b6102a2611c9c565b63389a75e1600c528082526020600c20805442116102fd5790826001600160a01b0392551680638b78c6d819547f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e08480a3638b78c6d8195580f35b636f5e881883526004601cfd5b5060203660031901126102045761031f61187b565b610327611c9c565b6001600160a01b038116908183528260205260ff6040842054166103dd5781156103b5573b61038d578082528160205260408220600160ff198254161790557f47d1c22a25bb3a5d4e481b9b1e6944c2eade3181a0a20b495ed61d35b5323f248280a280f35b6004827f33cae796000000000000000000000000000000000000000000000000000000008152fd5b6004837fc9435909000000000000000000000000000000000000000000000000000000008152fd5b602483837f9fb0d64c000000000000000000000000000000000000000000000000000000008252600452fd5b50346102045760a03660031901126102045760043567ffffffffffffffff811161049d57610120600319823603011261049d57610444611891565b6044359065ffffffffffff82168203610499576064359265ffffffffffff84168403610495576084359463ffffffff8616860361020457602061048d8787878787600401611ba0565b604051908152f35b8480fd5b8380fd5b5080fd5b5034610204576040366003190112610204576104bb61187b565b60243533835260036020526001600160a01b03604084205492169182156105fd5781156105ee578181106105d4576104f38282611964565b80151590816105c8575b50610591575060405161050f816118d5565b8181526002602082018481526040830190428252338752600460205260408720935184556001600160a01b036001850191511673ffffffffffffffffffffffffffffffffffffffff19825416179055519101556040519081527f04c56a409d50971e45c5a2d96e5d557d2b0f1d66d40f14b141e4c958b0f39b3260203392a380f35b8390606492600254917f8793fc79000000000000000000000000000000000000000000000000000000008452600452602452604452fd5b9050600254115f6104fd565b632e2a182f60e11b84523360045260245260445250606490fd5b6004846339d3420560e11b8152fd5b600484634261081360e11b8152fd5b503461020457602036600319011261020457600435610629611c9c565b62015180811161066d5760407fab3f1d5eaee409b7067167f77f1fa3f8a863366d6fb2b88559cd4f9b8e03e18291600554908060055582519182526020820152a180f35b6004827ff6aef41d000000000000000000000000000000000000000000000000000000008152fd5b508060031936011261020457807f302076c90000000000000000000000000000000000000000000000000000000060049252fd5b503461020457806003193601126102045760206001600160a01b0360015416604051908152f35b50346102045780600319360112610204576040517f70a082310000000000000000000000000000000000000000000000000000000081523060048201526020816024816001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000165afa9081156107ae578291610778575b602082604051908152f35b90506020813d6020116107a6575b8161079360209383611905565b8101031261049d5760209150515f61076d565b3d9150610786565b6040513d84823e3d90fd5b503461020457602036600319011261020457806107d461187b565b6107dc611c9c565b6001600160a01b037f00000000000000000000000000000000000000000000000000000000000000001690813b1561086c576001600160a01b03602484928360405195869485937fc23a5cea0000000000000000000000000000000000000000000000000000000085521660048401525af180156107ae5761085b5750f35b8161086591611905565b6102045780f35b5050fd5b5034610204578060031936011261020457610889611c9c565b806001600160a01b037f000000000000000000000000000000000000000000000000000000000000000016803b156108f9578180916004604051809481937fbb9fe6bf0000000000000000000000000000000000000000000000000000000083525af180156107ae5761085b5750f35b50fd5b503461020457806003193601126102045760206040516001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000168152f35b50346102045780600319360112610204576020600654604051908152f35b506020366003190112610204576001600160a01b0361097b61187b565b610983611cb8565b168015610ad8573415610a9b57808252600360205260408220541580610acd575b610a9b578082526003602052604082206109bf348254611943565b90557fa2a2db73af12c9f5bef6303364d44e78f97e992c353cd8659f3474c471427e9b6020604051348152a2806001600160a01b037f000000000000000000000000000000000000000000000000000000000000000016803b156108f95781602491604051928380927fb760faf900000000000000000000000000000000000000000000000000000000825230600483015234905af180156107ae57610a86575b507f9b779b17422d0df92223018b32b4d1fa46e071723d6817e2486d003becc55f005d80f35b81610a9091611905565b61020457805f610a60565b6044826002547f82222d6700000000000000000000000000000000000000000000000000000000825234600452602452fd5b5060025434106109a4565b6004827f719201ae000000000000000000000000000000000000000000000000000000008152fd5b506020366003190112610204576001600160a01b03610b1d61187b565b610b25611c9c565b168015610b7c576001600160a01b036001548273ffffffffffffffffffffffffffffffffffffffff19821617600155167f649c5e3d0ed183894196148e193af316452b0037e77d2ff0fef23b7dc722bed08380a380f35b6004827f7fa1287a000000000000000000000000000000000000000000000000000000008152fd5b50346102045760203660031901126102045760043567ffffffffffffffff811161049d57610bd69036906004016118a7565b610bdf91611a36565b959794938694604094929451996001600160a01b038b9a168a5265ffffffffffff1660208a015265ffffffffffff16604089015263ffffffff1660608801526fffffffffffffffffffffffffffffffff1660808701526fffffffffffffffffffffffffffffffff1660a086015260c0850160e090528160e08601526101008501378183016101000152601f1990601f01168101036101000190f35b503461020457602036600319011261020457600435610c97611c9c565b8015610cd5577fcacd94bd1e7bb1185c816a740d9439bc8eff8159f6f4ffad8d306b5aca2ebd9260406002548151908152836020820152a160025580f35b6004827f22e4fdc9000000000000000000000000000000000000000000000000000000008152fd5b50346102045780600319360112610204576020638b78c6d819546001600160a01b0360405191168152f35b50346102045760203660031901126102045760806001600160a01b03610d54610d4f61187b565b611971565b929391604051941515855260208501521660408301526060820152f35b50346102045760203660031901126102045760ff60406020926001600160a01b03610d9a61187b565b1681528084522054166040519015158152f35b5034610204576020366003190112610204576001600160a01b03610dcf61187b565b610dd7611cb8565b168082526004602052604082209060405191610df2836118d5565b8054835260026001600160a01b0360018301541691602085019283520154604084019080825215610fc45751600554610e2a91611943565b804210610f94575081845260036020526040842054835181811115610f8f5750805b80855215610f80578351610e5f91611964565b8285526003602052604085205581845260046020525f6002604086208281558260018201550155836001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000166001600160a01b038351168551823b1561049957604484928360405195869485937f205c2878000000000000000000000000000000000000000000000000000000008552600485015260248401525af180156107ae57610f6b575b505060206001600160a01b037f121eb3d5e027dba2c931e672efb7d244364546af71aef554f4c26e802c143c9b9251169351604051908152a3807f9b779b17422d0df92223018b32b4d1fa46e071723d6817e2486d003becc55f005d80f35b81610f7591611905565b61049957835f610f0c565b6004856339d3420560e11b8152fd5b610e4c565b84604491847f3f6aef51000000000000000000000000000000000000000000000000000000008352600452602452fd5b602485847f6dbc82f9000000000000000000000000000000000000000000000000000000008252600452fd5b503461020457608036600319011261020457600360043510156102045760243567ffffffffffffffff811161049d5761102d9036906004016118a7565b906044359160a08260643592611041611d2c565b81010312610499578135926001600160a01b0384168094036104955760208301359163ffffffff831680930361126f5760408401359360808101359060600135821561125b57600654908890828587048261109c8383611943565b1161123f575b50505088928181116111ff575b50506110d1926110c66110d895936110cb93611943565b611a23565b90611943565b9182611a23565b620f42408101908181116111eb57620f423f019081116111d7577f683b3fc4c8726e960b5b0aa3838c1071e2a9b7045fcd4dfc953fc1092923f5379284604093620f424061112a940493849182611964565b926001600160a01b03600154168952600360205285892061114c858254611943565b9055818111156111af576111837f3367befd2b2f39615cd79917c2153263c4af1d3945ec003e5d5bfc13a8d8583392602092611964565b838a5260038252868a20611198828254611943565b90558651908152a25b82519182526020820152a280f35b906111ba9250611964565b85875260036020526111d0848820918254611964565b90556111a1565b602485634e487b7160e01b81526011600452fd5b602486634e487b7160e01b81526011600452fd5b61120a929350611964565b600a810290808204600a149015171561122b576064900490826110c66110af565b602488634e487b7160e01b81526011600452fd5b61125393509061124e91611943565b611964565b5f82816110a2565b602488634e487b7160e01b81526012600452fd5b8580fd5b5060203660031901126102045760043561128b611c9c565b620249f081116112cf5760407f33ddf610723ec48e858790576fb3294cc312fcbd937c1475d53e3673145488eb91600654908060065582519182526020820152a180f35b6004827f627b654a000000000000000000000000000000000000000000000000000000008152fd5b50806003193601126102045760049061130e611c9c565b7f0e98a7a2000000000000000000000000000000000000000000000000000000008152fd5b50806003193601126102045763389a75e1600c52338152806020600c2055337ffa7b8eab7da67f412cc9575ed43464468f9bfbae89d1675917346ca6d8fe3c928280a280f35b50346102045760603660031901126102045760043567ffffffffffffffff811161049d57610120600319823603011261049d5760206113c86060926113bc611d2c565b60443590600401611dbc565b604092919251948593604085528051938491826040880152018686015e8383018501526020830152601f01601f19168101030190f35b5034610204576060366003190112610204576004356001600160a01b03811680910361049d5761142c611891565b60443591611438611c9c565b611440611cb8565b6001600160a01b0382169182156114f857601452826034526fa9059cbb00000000000000000000000084526020846044601082855af180600186511416156114da575b50836034526040519283527fedf7bea45e16025d7f82902171a24376f5f3a2c06d9d8c2be4d41bbc7292f74a60203394a4807f9b779b17422d0df92223018b32b4d1fa46e071723d6817e2486d003becc55f005d80f35b3d823b151710156114eb575f611483565b6390b8ec1884526004601cfd5b600485634261081360e11b8152fd5b50346102045780600319360112610204576020600254604051908152f35b50346102045780600319360112610204576020600554604051908152f35b50806003193601126102045763389a75e1600c523381526202a30042016020600c2055337fdbf36a107da19e49527a7176a1babf963b4b0ff8cde35ee35d6cd8f1f9ac7e1d8280a280f35b503461020457806003193601126102045733815260046020525f60026040832082815582600182015501557fe227a0e51918df92c3a9837808b4825847fa7c14cbacd937b650c337e91712416020604051338152a180f35b50346102045760403660031901126102045760049061160361187b565b507fad42eb99000000000000000000000000000000000000000000000000000000008152fd5b5060403660031901126102045761163e61187b565b6001600160a01b0360243591611652611c9c565b61165a611cb8565b16908115611715578280808084865af13d15611710573d61167a81611927565b906116886040519283611905565b81528460203d92013e5b156116e85760207f8455ae6be5d92f1df1c3c1484388e247a36c7e60d72055ae216dbc258f257d4b91604051908152a2807f9b779b17422d0df92223018b32b4d1fa46e071723d6817e2486d003becc55f005d80f35b6004837f27fcd9d1000000000000000000000000000000000000000000000000000000008152fd5b611692565b600483634261081360e11b8152fd5b506020366003190112610204576001600160a01b0361174161187b565b611749611c9c565b168082528160205260ff6040832054161561179857808252816020526040822060ff1981541690557f3525e22824a8a7df2c9a6029941c824cf95b6447f1e13d5128fd3826d35afe8b8280a280f35b7f2ac468fb000000000000000000000000000000000000000000000000000000008252600452602490fd5b5060203660031901126118775760043563ffffffff8116809103611877576117e9611c9c565b6001600160a01b037f00000000000000000000000000000000000000000000000000000000000000001690813b15611877575f906024604051809481937f0396cb60000000000000000000000000000000000000000000000000000000008352600483015234905af1801561186c57611860575080f35b61001891505f90611905565b6040513d5f823e3d90fd5b5f80fd5b600435906001600160a01b038216820361187757565b602435906001600160a01b038216820361187757565b9181601f840112156118775782359167ffffffffffffffff8311611877576020838186019501011161187757565b6060810190811067ffffffffffffffff8211176118f157604052565b634e487b7160e01b5f52604160045260245ffd5b90601f8019910116810190811067ffffffffffffffff8211176118f157604052565b67ffffffffffffffff81116118f157601f01601f191660200190565b9190820180921161195057565b634e487b7160e01b5f52601160045260245ffd5b9190820391821161195057565b6001600160a01b03165f52600460205260405f206040805192611993846118d5565b82549384815260026001600160a01b0360018601541694856020840152015492839101528115155f146119c857600193929190565b5f93508392508291508190565b90939293848311611877578411611877578101920390565b919091356001600160d01b031981169260068110611a09575050565b6001600160d01b0319929350829060060360031b1b161690565b8181029291811591840414171561195057565b6048929180841161187757603482013560601c93604e81116118775781604e116118775780611a6b91840190604e03906119ed565b60d01c92611a86611a806054604e85876119d5565b906119ed565b60d01c92611a986058605485846119d5565b90357fffffffff0000000000000000000000000000000000000000000000000000000081169160048110611b02575b505060e01c928060241161187757601482013560801c926034821061187757602483013560801c926058831061187757605801916057190190565b7fffffffff000000000000000000000000000000000000000000000000000000009250829060040360031b1b16165f80611ac7565b903590601e1981360301821215611877570180359067ffffffffffffffff82116118775760200191813603831361187757565b929192611b7682611927565b91611b846040519384611905565b829481845281830111611877578281602093845f960137010152565b92909391611bbb611bb46040860186611b37565b3691611b6a565b6020815191012094611bd3611bb46060870187611b37565b6020815191012094611be860e0820182611b37565b6034116118775760405196602088019883356001600160a01b03168a52602084013560408a015260608901526080880152608082013560a08801526014013560c087015260a081013560e087015260c0013561010086015246610120860152306101408601526001600160a01b031661016085015265ffffffffffff1661018084015265ffffffffffff166101a083015263ffffffff166101c08201526101c08152611c966101e082611905565b51902090565b638b78c6d819543303611cab57565b6382b429005f526004601cfd5b7f9b779b17422d0df92223018b32b4d1fa46e071723d6817e2486d003becc55f005c611d045760017f9b779b17422d0df92223018b32b4d1fa46e071723d6817e2486d003becc55f005d565b7f3ee5aeb5000000000000000000000000000000000000000000000000000000005f5260045ffd5b6001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000163303611d5e57565b60646040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152601860248201527f43616c6c6572206973206e6f7420456e747279506f696e7400000000000000006044820152fd5b6060929160e0820191611dd8611dd28483611b37565b90611a36565b6040919350809694959c925014158061215e575b6121365760065494611dfd88612169565b861161210e57611e4b6001600160a01b0393611e1c878f888c8e611ba0565b6020527b19457468657265756d205369676e6564204d6573736167653a0a33325f52603c600420923691611b6a565b915f926040519260208201918051806040146120d05760411461209a5750505050505b168015612072575f525f60205260ff60405f2054161598895f146120565760ff65ffffffffffff60a01b6001600160d01b03196001935b60d01b169360a01b16911617179761203b5763ffffffff1693621e84808511801561202f575b612007576110c685916110cb611ef8946fffffffffffffffffffffffffffffffff60c08901351690611a23565b620f424081019081811161195057620f423f0190811161195057620f42406001600160a01b039104911693845f52600360205260405f20548211611fdf57845f52600360205260405f20611f4d838254611964565b90556080830135611f6f611f688260801c60a0870135611943565b9285611b37565b60241161187757611fa7611fa1611fae946fffffffffffffffffffffffffffffffff60148195013560801c1690611943565b95612169565b9116611943565b9260405194602086015260408501526060840152608083015260a082015260a08152611fdb60c082611905565b9190565b5083805f52600360205260405f205490632e2a182f60e11b5f5260045260245260445260645ffd5b7f280b6fdc000000000000000000000000000000000000000000000000000000005f5260045ffd5b50620f42408510611ecb565b50505050505060405161204f602082611905565b5f81529190565b60ff65ffffffffffff60a01b6001600160d01b03195f93611ea5565b7f11ec9984000000000000000000000000000000000000000000000000000000005f5260045ffd5b808401515f1a60205260400151835292935090915b5f52516040526020604060805f60015afa505f81523d185190604052611e6e565b507f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff91929394955060400151601b8160ff1c016020521683526120af565b7f0359a00f000000000000000000000000000000000000000000000000000000005f5260045ffd5b7ff95eeeac000000000000000000000000000000000000000000000000000000005f5260045ffd5b506041851415611dec565b6121779060e0810190611b37565b603411611877576024013560801c9056fea264697066735822122016e3261a8218018e26ad1d10c1d4034df1fbc47197d122291b77ac5cfbcb282264736f6c634300081d0033";

        // Load environment variables
        // uint256 salt = vm.envUint("SALT");
        address owner = vm.envAddress("OWNER");
        address feeCollector = vm.envAddress("FEE_COLLECTOR");
        uint256 minDeposit = vm.envUint("MIN_DEPOSIT");
        uint256 withdrawalDelay = vm.envUint("WITHDRAWAL_DELAY");
        uint256 unaccountedGas = vm.envUint("UNACCOUNTED_GAS");

        // Parse signers from comma-separated string
        string[] memory signers = vm.envString("SIGNERS", ",");
        address[] memory signersAddr = new address[](signers.length);
        for (uint256 i = 0; i < signers.length; i++) {
            signersAddr[i] = vm.parseAddress(signers[i]);
        }

        bytes memory constructorArgs =
            abi.encode(owner, entryPoint, signersAddr, feeCollector, minDeposit, withdrawalDelay, unaccountedGas);

        // Concatenate bytecode + constructor arguments
        bytes memory finalBytecode = abi.encodePacked(deployedBytecode, constructorArgs);

        // Deploy contract if needed
        deployGeneric(deployerPrivateKey, saltString, finalBytecode, contractName);
    }

    function deployGeneric(
        uint256 deployerPrivateKey,
        string memory saltString,
        bytes memory finalBytecode,
        string memory contractName
    ) public {
        // Compute derived salt
        bytes32 derivedSalt = keccak256(abi.encodePacked(saltString));

        // Compute contract address before deployment
        address computedAddress = deployerInstance.addressOf(derivedSalt);

        console.log(string(abi.encodePacked(contractName, " Computed Address:")), computedAddress);

        // Check if contract is already deployed
        uint256 codeSize;
        assembly {
            codeSize := extcodesize(computedAddress)
        }

        if (codeSize == 0) {
            console.log(string(abi.encodePacked(contractName, " not deployed, deploying now...")));
            deployContract(deployerPrivateKey, derivedSalt, finalBytecode, contractName, computedAddress);
        } else {
            console.log(string(abi.encodePacked(contractName, " already deployed at:")), computedAddress);
        }
    }

    function deployContract(
        uint256 deployerPrivateKey,
        bytes32 derivedSalt,
        bytes memory finalBytecode,
        string memory contractName,
        address computedAddress
    ) internal {
        uint256 chainId = block.chainid;

        uint256 gasPrice = DEPLOYMENT_CHAIN_GAS_PRICES[chainId];
        require(gasPrice > 0, "No deployment gas price set for this chain");

        console.log("Using gas price:", gasPrice);

        // Deploy contract using deployer's private key
        vm.startBroadcast(deployerPrivateKey);
        (bool success,) = address(deployerInstance).call{gas: 5_000_000}(
            abi.encodeWithSignature("deploy(bytes32,bytes)", derivedSalt, finalBytecode)
        );
        vm.stopBroadcast();

        require(success, "Contract deployment failed");

        console.log(string(abi.encodePacked("Transaction success: ", contractName)));

        // Verify deployment by checking contract existence
        uint256 codeSize;
        assembly {
            codeSize := extcodesize(computedAddress)
        }

        if (codeSize == 0) {
            console.log(string(abi.encodePacked("Invalid deployment of ", contractName)));
        } else {
            console.log(string(abi.encodePacked(contractName, " Deployed Successfully at:")), computedAddress);
        }
    }
}
